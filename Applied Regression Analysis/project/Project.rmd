---
title: "Project"
output: html_document
date: "2023-11-14"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Libraries}
library(ordinal)
library(dplyr)
library(magrittr)
library(tidyverse)
```

## Logit model.

```{r Call Data}
# Summon and relevel data.
math_dept = read.csv(file = "../data/math dept.csv",header=TRUE,sep=",") %>% filter(Sex != "Unknown")
# Convert all character columns into factors.
  math_dept = math_dept %>% mutate_if(is.character, as.factor)
# Designate references.
  math_dept$Major.ref = relevel(math_dept$Major, ref = "Pre-Applied Statistics")
  math_dept$Status.ref = relevel(math_dept$Status, ref = "Enrolled")
  math_dept$Ethnicity.ref = relevel(fct_collapse(math_dept$Ethnicity, Other = c("Unknown","Two or More Races","Visa Non-U.S.")), ref = "White")
  math_dept$Sex.ref = relevel(math_dept$Sex,ref = "Male")
  math_dept$Local.ref = relevel(math_dept$Local, ref = "Non-Local")
 # math_dept$Sex 
```

```{r Develop Model}
summary(fitted.model<- clm(Status.ref ~ Major.ref + HS_GPA + Ethnicity.ref + Sex.ref + Local.ref,
      data=math_dept, link="logit"))

# Acquire degrees of freedom based on length of coefficients.
# Acquire n based on fitted.model nobs
# Since the different models don't change these, this needs to only be done once.
deg_f = as.integer(length(fitted.model$beta)) 
p = as.integer(length(fitted.model$coefficients))
n = fitted.model$nobs
```

```{r Model Quality}
# Calculate AICC, BIC.
AICC = -2*logLik(fitted.model)+2*p*n/(n-p-1)

# Sprintf is used to create LaTex-ready table outputs.
cat(sprintf("AIC is %s.\n", fitted.model$info$AIC))
cat(sprintf("AICC is %s.\n", AICC))
cat(sprintf("BIC is %s.\n", BIC(fitted.model)))

# Develop null model.
null.model = clm(Status.ref ~ 1, 
                 data=math_dept, 
                 link="logit")

# Deviance test.
deviance = -2*(logLik(null.model)-logLik(fitted.model))
deviance_pval = pchisq(deviance,deg_f,lower.tail = FALSE)

cat(sprintf("Deviance test statistic is %s.\n", round(deviance,10)))
cat(sprintf("Deviance p-value is %s.", round(deviance_pval,70)))
```

```{r Logistic Prediction}
# Calculates a predicted value via the fitted model.
predicted = predict(fitted.model, data.frame(
  subscribed=3, magazine.rel = "no", resolved.rel= "yes"), type="prob")

print(predicted)
```